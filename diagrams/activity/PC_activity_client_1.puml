@startuml
title Диаграмма деятельности: Запись на сеанс (Клиент)

start
:Переход на страницу записи;
:Выбор мастера и даты;

partition AJAX_Проверка_Слотов {
    if (Мастер в отпуске на эту дату?) then (да)
        :Показать: "Мастер в отпуске";
        stop
    else (нет)
        :Запрос рабочих часов (Availability);
        :Фильтрация уже занятых слотов;
        :Отображение доступных кнопок времени;
    endif
}

:Выбор времени и заполнение данных;
:Загрузка эскиза;
:Указание даты рождения;

if (Возраст < 18 лет?) then (да)
    :Требовать файл согласия родителей;
    if (Файл прикреплен?) then (нет)
        :Ошибка: "Необходимо согласие";
        detach
    else (да)
    endif
else (нет)
endif

:Нажать кнопку "Записаться";

partition Валидация_Django {
    if (Слот всё еще свободен?) then (нет)
        :Ошибка: "Это время уже заняли";
        detach
    else (да)
        :Создание/обновление профиля клиента;
        :Создание записи (Appointment) со статусом 'pending';
    endif
}

:Перенаправление на страницу успеха;
stop
@enduml